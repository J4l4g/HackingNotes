[[192.168.100.7(Nagini)]]

Haremos un [[NMAP]]
`nmap -sT -Pn -p- --open -T5 -v -n 192.168.100.5`

```python
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
80/tcp   open  http
2222/tcp open  EtherNetIP-1
9898/tcp open  monkeycom
```

Vemos que el puerto del FTP esta activado así que vamos a probar a conectarnos, vemos que se puede acceder como usuarios `anonymous`

Vemos un binario llamado `server_hogwarts` así que con strace vamos a ver que es lo que hace y en que consiste: `strace ./server_hogwarts`, vemos que lo que realiza es montar un servidor por el puerto `9898`

Si ejecutamos el binario podremos acceder a el con netcat usando `nc localhost 9898` que es el puerto que estaba abierto durante el nmap.
El binario pide un input así que si no se ha definido bien un tamaño de buffer sin sanitizarlo se podría acontecer un bufferoverflow

Para poder realizar esto nos ejecutaremos el programa con la herramienta de gdb: `gdb ./server_hpgwarts -q` y para correr la herramienta usaremos la r una vez dentro de gdb.

Y en la otra terminal nos conectamos con netcat e introducimos todas las "A" posibles, y llenaremos el EIP de "A" o en hexadecimal 4141414141.

Si ejecutamos checsec nos mostrara si NX esta desactivado que nos permitirá hacer que un flujo de la pila se interprete cómo shellcode

En gdb haremos `cyclic 1024` para que nos cree un patrón de letras para identificar donde se llena el EIP
Una vez se llena el EIP copiamos el valor hexadecimal y ejecutamos `cyclic -o 0x62616164` y te dice en que bite esta el offset

Ahora para apuntar al EIP directamente usaremos el siguiente comando de python para llenar el EIP y verificar que se llena de "B" `python3 -c 'print("A"*112 + "B"*4 +"C"*100)'` y al llenarlo nuestro ESP apunta al comienzo de las letra "C" 

Ahora tenemos que hacer que EIP apunte directamente al ESP para que una vez salte a este se ejecute un shellcode

Vamos a realizar un `exploit.py` para realizar esto:







